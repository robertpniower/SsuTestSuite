pipeline {
    agent any
    tools {
        nodejs 'NodeJS 23'
    }   
    stages {
        
        stage('Build') {
            steps {
                echo 'Install Dependencies...'
                sh 'rm -r -f node_modules/'
                sh 'rm -f package-lock.json'
                sh 'node --version'
                sh 'npm install'                   
                }
            }

        stage('Test') { 
            steps {
                echo 'Starting Test Automation Suits...'
                sh ('npm run ssu-v3-test')   
                }                    
            }

        // stage('Generating Test Reports...') {
        //     steps {
        //     sh 'npm run report:history && npm run report.ci'
        //     script {
        //             allure([
        //                     includeProperties: false,
        //                     jdk: '',
        //                     properties: [],
        //                     reportBuildPolicy: 'ALWAYS',
        //                     results: [[path: 'target/allure-results']]
        //             ])
        //     }   
        //     }
        // }
    }
    post{
        success{
            echo 'The Automation finish successfully'
        }

        failure{
            echo 'Something went wrong'
    
        }
        always{
            sh 'npm run report:history && npm run report.ci'
           script {
                    allure([
                            includeProperties: false,
                            jdk: '',
                            properties: [],
                            reportBuildPolicy: 'ALWAYS',
                            results: [[path: 'target/allure-results']]
                    ])
            }
        }
    }
}